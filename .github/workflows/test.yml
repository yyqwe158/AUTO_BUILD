name: å·¥ä½œæµä¾‹å­
run-name: ${{ github.actor }} æ­£åœ¨æµ‹è¯• GitHub Actions ğŸš€
on:
  workflow_dispatch:
    inputs:
      phone:
        description: 'é€‰æ‹©æ‰‹æœºå‹å·ï¼š'
        required: true
        default: 'å°ç±³10'
        type: choice
        options:
          - å°ç±³10
          - å°ç±³10pro
      susfs:
        description: 'æ˜¯å¦é›†æˆSUSFS'
        required: true
        type: boolean
      version:
        description: 'è‡ªå®šä¹‰ç‰ˆæœ¬åï¼ˆå¦‚perf-xxxï¼‰/å¯ä¸ºç©ºï¼ˆåˆ™ä¸ºn0kernelï¼‰'
        required: false
        type: string
jobs:
  test_job:
    runs-on: ubuntu-22.04
    env:
      CCACHE_COMPILERCHECK: "%compiler% -dumpmachine; %compiler% -dumpversion"
      CCACHE_NOHASHDIR: "true"
      CCACHE_HARDLINK: "true"
      CI: "false"
      MODEL: ${{ inputs.phone == 'å°ç±³10' && 'Mi10' || 'MI10PRO' }} 
    steps:
      - run: echo "ğŸ‰ è¯¥ä»»åŠ¡è‡ªåŠ¨è§¦å‘äº ${{ github.event_name }} äº‹ä»¶."
      - run: echo "ğŸ§ è¿™ä¸ªä»»åŠ¡ç°åœ¨è¿è¡Œäºç³»ç»Ÿ ${{ runner.os }} çš„æœåŠ¡ä¸»æœºåœ¨Github!"
      - run: echo "ğŸ” ä½ ç°åœ¨çš„åˆ†æ”¯ä¸º ${{ github.ref }} å’Œä½ çš„ä»“åº“æ˜¯ ${{ github.repository }}."
      - name: æ£€æŸ¥ä»“åº“ä»£ç 
        uses: actions/checkout@v4
      - run: echo "ğŸ’¡ è¿™ä¸ª ${{ github.repository }} ä»“åº“å·²ç»è¢«å…‹éš†åˆ°runner."
      - run: echo "ğŸ–¥ï¸ è¯¥å·¥ä½œæµç°åœ¨å·²ç»å‡†å¤‡å¥½åœ¨runnerä¸Šæµ‹è¯•ä»£ç "
      
      - name: æ£€å‡ºä»“åº“è„šæœ¬åˆ°è¿è¡Œå™¨
        uses: actions/checkout@v4  
      - name: æˆäºˆ x æƒé™
        run: chmod +x ./hello.sh
      - name: è¿è¡Œè¯¥è„šæœ¬
        run: ./hello.sh

      - name: è¾“å‡ºç¯å¢ƒå˜é‡
        run: |
          echo $MODEL
      
      - name: è¾“å‡ºè¾“å…¥æ¡†å†…å®¹
        run: |
          echo "æ‰‹æœºæœºå‹ä¸º ${{ inputs.phone }} "
          echo "æ˜¯å¦é›†æˆsusfs ${{ inputs.susfs }} "
          echo "è‡ªå®šä¹‰ç‰ˆæœ¬å·ä¸º ${{ inputs.version }} "
          
      - name: åˆ¤æ–­ä¸€äº›è¾“å…¥æ¡†å†…å®¹
        run: |    
          if [ $MODEL = Mi10 ]; then
            echo "é€‰æ‹©å°ç±³10é…ç½®çš„è¡¥ä¸"
            echo "defconfig=vendor/umi_defconfig" >> $GITHUB_ENV
          fi

          if [ $MODEL = MI10PRO ]; then
            echo "é€‰æ‹©å°ç±³10é…ç½®çš„è¡¥ä¸"
            echo "defconfig=vendor/cmi_defconfig" >> $GITHUB_ENV
          fi

          echo "å½“å‰é…ç½®æ–‡ä»¶ä¸º"
          echo $defconfig
      
      # - name: æŸ¥çœ‹æˆæœ
      #   run: |
      #       dd if=/dev/zero of=Image bs=1M count=1
      #       cp Image ./Anykernel/

      # - name: 'ä¸Šä¼ åˆ·å…¥åŒ…'
      #   uses: actions/upload-artifact@v4
      #   with:
      #     name: KSUN_SUS_Mi10.zip
      #     path: ./Anykernel/*
      #     retention-days: 2

